# 文本切片和向量化演示脚本

这个目录包含了三个演示脚本，用于展示 haiku.rag 系统的文本切片和向量化功能。

## 脚本说明

### 1. `simple_chunking_demo.py` - 简化文本切片演示

**功能**：专注于展示文本切片功能，不需要配置嵌入模型。

**展示内容**：
- 原始文本分析（字符数、token数）
- 文本切片过程和配置
- 每个切片的详细信息
- 切片统计分析和质量评估

**使用方法**：
```bash
cd scripts
python simple_chunking_demo.py
```

**优点**：
- 无需配置嵌入模型
- 运行速度快
- 专注于切片功能演示

### 2. `embedding_demo.py` - 向量化演示

**功能**：专门展示文本向量化功能。

**展示内容**：
- 嵌入模型配置信息
- 文本向量化过程
- 向量数据统计分析
- 向量相似度计算
- 向量分布分析和质量评估

**使用方法**：
```bash
cd scripts
python embedding_demo.py
```

**前提条件**：
- 需要正确配置嵌入模型环境变量
- 安装相应的依赖包

### 3. `demo_chunking_and_embedding.py` - 完整演示

**功能**：展示完整的文本处理流程，包括切片和向量化。

**展示内容**：
- 原始文本分析
- 文本切片详细过程
- 向量化分析
- 统计摘要
- 结果保存到JSON文件

**使用方法**：
```bash
cd scripts
python demo_chunking_and_embedding.py
```

**输出**：
- 控制台详细输出
- `chunking_demo_result.json` 结果文件

## 环境配置

### 基本要求

确保已安装 haiku.rag 包：
```bash
pip install -e .
```

### 嵌入模型配置

如果要运行向量化相关的演示，需要配置环境变量：

#### OpenAI 嵌入
```bash
export EMBEDDINGS_PROVIDER=openai
export EMBEDDINGS_MODEL=text-embedding-3-small
export EMBEDDINGS_VECTOR_DIM=1536
export OPENAI_API_KEY=your_api_key
```

#### Ollama 嵌入
```bash
export EMBEDDINGS_PROVIDER=ollama
export EMBEDDINGS_MODEL=nomic-embed-text
export EMBEDDINGS_VECTOR_DIM=768
export OLLAMA_BASE_URL=http://localhost:11434
```

#### SiliconFlow 嵌入
```bash
export EMBEDDINGS_PROVIDER=siliconflow
export EMBEDDINGS_MODEL=BAAI/bge-large-zh-v1.5
export EMBEDDINGS_VECTOR_DIM=1024
export SILICONFLOW_API_KEY=your_api_key
export SILICONFLOW_BASE_URL=https://api.siliconflow.cn/v1
```

## 示例输出

### 文本切片演示输出示例

```
================================================================================
                               文本切片演示
================================================================================

------------------------------------------------------------
 1. 原始文本分析
------------------------------------------------------------
文本长度: 1234 字符
Token数量: 456 tokens
切片配置: 256 tokens/块, 32 tokens重叠

原始文本内容:
----------------------------------------
賞之味控股有限公司（「本公司」）董事會...
----------------------------------------

------------------------------------------------------------
 2. 文本切片过程
------------------------------------------------------------
切片完成，共生成 3 个文本块

------------------------------------------------------------
 3. 切片详细分析
------------------------------------------------------------

📄 切片 1:
   字符数: 456
   Token数: 234
   Token密度: 1.95 字符/token
   内容: 賞之味控股有限公司（「本公司」）董事會...
```

### 向量化演示输出示例

```
================================================================================
                               文本向量化演示
================================================================================

------------------------------------------------------------
 1. 嵌入模型配置
------------------------------------------------------------
提供商: openai
模型: text-embedding-3-small
向量维度: 1536
✅ 嵌入模型加载成功

------------------------------------------------------------
 2. 文本向量化過程
------------------------------------------------------------

📝 文本 1: 賞之味控股有限公司將舉行股東週年大會
   ✅ 向量化成功
   📊 維度: 1536
   📊 範圍: [-0.123456, 0.789012]
   📊 均值: 0.001234
   📊 模長: 1.234567
   📊 稀疏度: 12.34%
```

## 自定义配置

### 修改切片参数

在脚本中可以修改以下参数：

```python
# 在 simple_chunking_demo.py 中
await demo_chunking(
    sample_text.strip(), 
    chunk_size=512,      # 切片大小
    chunk_overlap=64     # 重叠大小
)
```

### 修改测试文本

可以在脚本中替换 `sample_text` 变量来测试不同的文本内容。

## 故障排除

### 常见问题

1. **ImportError**: 确保已正确安装 haiku.rag 包
2. **嵌入模型错误**: 检查环境变量配置和API密钥
3. **网络连接问题**: 确保能访问相应的API服务

### 调试模式

可以在脚本开头添加调试信息：

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 扩展功能

### 添加新的测试文本

可以在脚本中添加更多测试文本来比较不同类型内容的处理效果：

```python
test_texts = [
    "中文金融文档...",
    "English financial document...",
    "技术文档内容...",
    "法律条文内容..."
]
```

### 自定义分析指标

可以添加更多的分析指标，如：
- 语义一致性评估
- 切片边界质量评分
- 向量聚类分析

## 贡献

欢迎提交改进建议和新功能！
