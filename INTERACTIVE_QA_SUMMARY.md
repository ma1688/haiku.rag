# å¾ªç¯é—®ç­”QAç³»ç»Ÿ - å®Œæˆæ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºhaiku.ragé¡¹ç›®æ¶æ„ï¼Œæˆ‘æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„**å¾ªç¯é—®ç­”QAç³»ç»Ÿ**ï¼Œæ”¯æŒå¯¹è¯ä¸Šä¸‹æ–‡ä¿æŒã€å¤šè½®äº¤äº’å’Œä¸°å¯Œçš„ç»ˆç«¯ç•Œé¢ã€‚

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ ¸å¿ƒç»„ä»¶

#### ğŸ“ ConversationHistory (å¯¹è¯å†å²ç®¡ç†)
- **ä½ç½®**: `src/haiku/rag/qa/interactive.py`
- **åŠŸèƒ½**:
  - ç®¡ç†å¯¹è¯å†å²è®°å½•ï¼ˆæœ€å¤šä¿å­˜10è½®å¯¹è¯ï¼‰
  - ç”Ÿæˆä¸Šä¸‹æ–‡æ‘˜è¦ç”¨äºå¢å¼ºåç»­é—®é¢˜
  - æ”¯æŒæ¸…ç©ºå†å²è®°å½•
  - æ—¶é—´æˆ³è®°å½•æ¯æ¬¡äº¤äº’

#### ğŸ¤– ContextAwareQAAgent (ä¸Šä¸‹æ–‡æ„ŸçŸ¥QAä»£ç†)
- **ä½ç½®**: `src/haiku/rag/qa/interactive.py`
- **åŠŸèƒ½**:
  - ç»§æ‰¿ç°æœ‰QAä»£ç†åŠŸèƒ½
  - è‡ªåŠ¨å°†å¯¹è¯ä¸Šä¸‹æ–‡æ·»åŠ åˆ°æ–°é—®é¢˜ä¸­
  - æ™ºèƒ½ä¸Šä¸‹æ–‡é•¿åº¦æ§åˆ¶ï¼ˆé˜²æ­¢tokenæº¢å‡ºï¼‰
  - è¿”å›ç­”æ¡ˆå’Œæœç´¢æºä¿¡æ¯

#### ğŸ–¥ï¸ InteractiveQASession (äº¤äº’å¼ä¼šè¯ç•Œé¢)
- **ä½ç½®**: `src/haiku/rag/qa/interactive.py`
- **åŠŸèƒ½**:
  - ç¾è§‚çš„Richç»ˆç«¯ç•Œé¢
  - æ”¯æŒå¤šç§ç‰¹æ®Šå‘½ä»¤
  - å®æ—¶æ€è€ƒæŒ‡ç¤ºå™¨
  - æºæ–‡æ¡£æ˜¾ç¤º
  - å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†

### 2. CLIé›†æˆ

#### æ–°å¢å‘½ä»¤
```bash
haiku-rag chat [--db DATABASE] [--model MODEL]
```
- **ä½ç½®**: `src/haiku/rag/cli.py`
- **åŠŸèƒ½**: å¯åŠ¨äº¤äº’å¼èŠå¤©ä¼šè¯

### 3. ç‰¹æ®Šå‘½ä»¤æ”¯æŒ

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `/help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/history` | æŸ¥çœ‹å¯¹è¯å†å² |
| `/clear` | æ¸…ç©ºå¯¹è¯å†å² |
| `/search <query>` | ç›´æ¥æœç´¢æ–‡æ¡£ |
| `/quit` æˆ– `/exit` | é€€å‡ºä¼šè¯ |

### 4. æ¼”ç¤ºå’Œæµ‹è¯•

#### ğŸ® ç®€åŒ–æ¼”ç¤º
- **ä½ç½®**: `examples/simple_interactive_demo.py`
- **åŠŸèƒ½**: æ— ä¾èµ–çš„æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º
- **ç‰¹ç‚¹**: 
  - æ¨¡æ‹ŸçŸ¥è¯†åº“
  - å®Œæ•´å¯¹è¯æµç¨‹
  - ä¸Šä¸‹æ–‡ä¿æŒæµ‹è¯•

#### ğŸš€ å®Œæ•´æ¼”ç¤º
- **ä½ç½®**: `examples/interactive_qa_demo.py`
- **åŠŸèƒ½**: å®Œæ•´åŠŸèƒ½æ¼”ç¤ºï¼ˆéœ€è¦å®Œæ•´ä¾èµ–ï¼‰
- **ç‰¹ç‚¹**:
  - è‡ªåŠ¨åˆ›å»ºç¤ºä¾‹çŸ¥è¯†åº“
  - å¤šä¸»é¢˜æ–‡æ¡£ï¼ˆPythonã€MLã€æ•°æ®ç§‘å­¦ï¼‰
  - ä¸´æ—¶æ•°æ®åº“è‡ªåŠ¨æ¸…ç†

#### ğŸ§ª æµ‹è¯•å¥—ä»¶
- **ä½ç½®**: `tests/test_interactive_qa.py`
- **è¦†ç›–**: 
  - ConversationHistoryåŠŸèƒ½æµ‹è¯•
  - ContextAwareQAAgentæµ‹è¯•
  - InteractiveQASessionæµ‹è¯•
  - é›†æˆæµ‹è¯•

### 5. æ–‡æ¡£

#### ğŸ“š å®Œæ•´æ–‡æ¡£
- **ä½ç½®**: `docs/interactive_qa.md`
- **å†…å®¹**:
  - åŠŸèƒ½ä»‹ç»
  - ä½¿ç”¨æŒ‡å—
  - APIå‚è€ƒ
  - é…ç½®è¯´æ˜
  - æ•…éšœæ’é™¤
  - é›†æˆç¤ºä¾‹

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†
```python
# è‡ªåŠ¨ä¸Šä¸‹æ–‡å¢å¼º
enhanced_question = f"""
Previous conversation context:
{context}

Current question: {question}

Please answer the current question, taking into account the conversation context if relevant.
"""
```

### æ™ºèƒ½æœç´¢é›†æˆ
- æ··åˆæœç´¢ï¼ˆå‘é‡+å…¨æ–‡ï¼‰
- æœç´¢ç»“æœè¯„åˆ†æ˜¾ç¤º
- æºæ–‡æ¡£è¿½è¸ª
- ç›¸å…³æ€§æ’åº

### ä¸°å¯Œçš„ç”¨æˆ·ç•Œé¢
- ğŸ¤– è¡¨æƒ…ç¬¦å·å¢å¼ºä½“éªŒ
- ğŸ“š æºæ–‡æ¡£å¼•ç”¨
- ğŸ¤” å®æ—¶æ€è€ƒæŒ‡ç¤ºå™¨
- ğŸ“œ å¯¹è¯å†å²æŸ¥çœ‹
- âœ… æ“ä½œç¡®è®¤åé¦ˆ

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. ä¸Šä¸‹æ–‡ä¿æŒ
- **é—®é¢˜**: "What is Python?" â†’ "What are its features?"
- **ç³»ç»Ÿ**: è‡ªåŠ¨ç†è§£"its"æŒ‡ä»£Pythonï¼Œæä¾›ç›¸å…³ç­”æ¡ˆ

### 2. å¤šè½®å¯¹è¯
- æ”¯æŒè‡ªç„¶çš„follow-upé—®é¢˜
- æ™ºèƒ½ä¸Šä¸‹æ–‡æˆªæ–­ï¼ˆé¿å…tokené™åˆ¶ï¼‰
- å¯¹è¯å†å²ç®¡ç†

### 3. ç”¨æˆ·ä½“éªŒ
- ç›´è§‚çš„å‘½ä»¤ç³»ç»Ÿ
- ç¾è§‚çš„ç»ˆç«¯ç•Œé¢
- å®æ—¶åé¦ˆ
- é”™è¯¯å¤„ç†

### 4. æ‰©å±•æ€§
- å…¼å®¹æ‰€æœ‰ç°æœ‰QAæä¾›å•†ï¼ˆOllamaã€OpenAIã€Anthropicï¼‰
- å¯é…ç½®çš„ä¸Šä¸‹æ–‡é•¿åº¦
- æ¨¡å—åŒ–è®¾è®¡

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```bash
# å¯åŠ¨äº¤äº’å¼ä¼šè¯
haiku-rag chat

# ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®åº“
haiku-rag chat --db my_knowledge.db

# ä½¿ç”¨ç‰¹å®šæ¨¡å‹
haiku-rag chat --model gpt-4o-mini
```

### Python API
```python
from haiku.rag.qa.interactive import start_interactive_qa

# å¯åŠ¨äº¤äº’å¼ä¼šè¯
await start_interactive_qa("database.db")
```

### ç¼–ç¨‹å¼ä½¿ç”¨
```python
from haiku.rag.qa.interactive import ContextAwareQAAgent
from haiku.rag.client import HaikuRAG

async with HaikuRAG("database.db") as client:
    agent = ContextAwareQAAgent(client)
    
    # å¤šè½®å¯¹è¯
    answer1, sources1 = await agent.answer_with_context("What is Python?")
    answer2, sources2 = await agent.answer_with_context("What are its benefits?")
    # ç¬¬äºŒä¸ªé—®é¢˜ä¼šè‡ªåŠ¨åŒ…å«ç¬¬ä¸€ä¸ªé—®é¢˜çš„ä¸Šä¸‹æ–‡
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•
âœ… ConversationHistory - å†å²ç®¡ç†  
âœ… ContextAwareQAAgent - ä¸Šä¸‹æ–‡æ„ŸçŸ¥  
âœ… InteractiveQASession - äº¤äº’ç•Œé¢  
âœ… CLIé›†æˆ - å‘½ä»¤è¡Œæ¥å£  
âœ… ç‰¹æ®Šå‘½ä»¤ - /help, /history, /clearç­‰  
âœ… é”™è¯¯å¤„ç† - å¼‚å¸¸æƒ…å†µå¤„ç†  

### æ¼”ç¤ºéªŒè¯
âœ… ç®€åŒ–æ¼”ç¤ºè¿è¡ŒæˆåŠŸ  
âœ… å¯¹è¯ä¸Šä¸‹æ–‡ä¿æŒæ­£å¸¸  
âœ… æœç´¢åŠŸèƒ½å·¥ä½œæ­£å¸¸  
âœ… ç‰¹æ®Šå‘½ä»¤å“åº”æ­£ç¡®  

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/haiku/rag/qa/
â”œâ”€â”€ interactive.py          # æ ¸å¿ƒäº¤äº’å¼QAç³»ç»Ÿ
â”œâ”€â”€ __init__.py             # æ›´æ–°çš„QAå·¥å‚å‡½æ•°
â””â”€â”€ ...

examples/
â”œâ”€â”€ interactive_qa_demo.py      # å®Œæ•´åŠŸèƒ½æ¼”ç¤º
â””â”€â”€ simple_interactive_demo.py  # ç®€åŒ–æ¼”ç¤º

tests/
â””â”€â”€ test_interactive_qa.py      # æµ‹è¯•å¥—ä»¶

docs/
â””â”€â”€ interactive_qa.md           # å®Œæ•´æ–‡æ¡£

src/haiku/rag/
â””â”€â”€ cli.py                      # æ›´æ–°çš„CLIï¼ˆæ–°å¢chatå‘½ä»¤ï¼‰
```

## ğŸ‰ æ€»ç»“

æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç”¨æˆ·å‹å¥½çš„**å¾ªç¯é—®ç­”QAç³»ç»Ÿ**ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

1. **æ™ºèƒ½å¯¹è¯ä¸Šä¸‹æ–‡** - è‡ªåŠ¨ç†è§£å’Œä¿æŒå¯¹è¯å†å²
2. **ä¸°å¯Œäº¤äº’ç•Œé¢** - ç¾è§‚çš„ç»ˆç«¯UIå’Œå®æ—¶åé¦ˆ
3. **çµæ´»å‘½ä»¤ç³»ç»Ÿ** - æ”¯æŒå¤šç§ç‰¹æ®Šæ“ä½œå‘½ä»¤
4. **å®Œæ•´é›†æˆ** - ä¸ç°æœ‰haiku.ragæ¶æ„æ— ç¼é›†æˆ
5. **å…¨é¢æµ‹è¯•** - åŒ…å«å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
6. **è¯¦ç»†æ–‡æ¡£** - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’ŒAPIæ–‡æ¡£

è¯¥ç³»ç»Ÿå¯ä»¥ç«‹å³æŠ•å…¥ä½¿ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›è‡ªç„¶ã€æµç•…çš„çŸ¥è¯†åº“é—®ç­”ä½“éªŒï¼
